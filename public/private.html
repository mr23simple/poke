<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokemon GO | My Profile</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
    <link rel="manifest" href="/assets/site.webmanifest">
    <link rel="shortcut icon" href="/assets/favicon.ico">
    <link rel="stylesheet" href="style-base.css">
    <link rel="stylesheet" href="style-private.css">
    <link rel="stylesheet" href="style-header.css">
    <link rel="stylesheet" href="style-subheader.css">
    <!-- 1. Include Vue.js library -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body class="dashboard-private">
    <div id="header-placeholder"></div>
    <div id="subheader-placeholder"></div>
    <!-- This is the main container for our Vue app -->
    <div id="app" class="container">
        

        <div v-if="loading" class="loading-overlay">
            <div class="loading-spinner"></div>
            <p class="loading-message">Loading player data...</p>
        </div>

        <main v-else>
            <!-- Character Tab -->
            <section id="character-section" v-show="activeTab === 'character'">
                <div class="dashboard-grid">
                    <!-- Left Column -->
                    <div class="left-column">
                        <section class="card" id="trainer-summary">
                            <h2>Trainer Summary</h2>
                            <div class="trainer-info">
                                <div class="team-logo" :style="{ backgroundColor: teamColor }"></div>
                                <div><strong>Lv. {{ player.level }}</strong></div>
                            </div>
                            <div class="xp-bar-container">
                                <div class="xp-bar" :style="{ width: xpPercentage + '%' }"></div>
                            </div>
                            <p class="xp-text">{{ xpProgressText }}</p>
                            <div class="grid-stats">
                                <div><span>Stardust</span><strong>{{ stardust.toLocaleString() }}</strong></div>
                                <div><span>PokéCoins</span><strong>{{ pokecoins.toLocaleString() }}</strong></div>
                                <div><span>Pokémon Caught</span><strong>{{ player.numPokemonCaptured?.toLocaleString() }}</strong></div>
                                <div><span>Pokédex Entries</span><strong>{{ player.numUniquePokedexEntries?.toLocaleString() }}</strong></div>
                                <div><span>Distance Walked</span><strong>{{ parseFloat(player.kmWalked || 0).toFixed(2) }} km</strong></div>
                                <div><span>PokéStops Visited</span><strong>{{ player.pokeStopVisits?.toLocaleString() }}</strong></div>
                            </div>
                        </section>

                        <section class="card" id="item-summary">
                            <div class="summary-header">
                                <h2>Item Bag</h2>
                                <button class="btn-secondary" @click="itemsExpanded = !itemsExpanded">
                                    {{ itemsExpanded ? 'Collapse' : 'Expand All' }}
                                </button>
                            </div>
                            <!-- Collapsed View -->
                            <div v-if="!itemsExpanded" class="item-summary-collapsed">
                                <p><strong>Poké Balls:</strong> {{ totalPokeBalls.toLocaleString() }}</p>
                                <p><strong>Potions:</strong> {{ totalPotions.toLocaleString() }}</p>
                                <p><strong>Revives:</strong> {{ totalRevives.toLocaleString() }}</p>
                            </div>
                            <!-- Expanded View -->
                            <div v-else>
                                <template v-for="category in itemCategoryOrder" :key="category">
                                    <div v-if="groupedItems[category]">
                                        <h3 class="item-category-header">{{ category }}</h3>
                                        <div class="item-grid-container">
                                            <div v-for="item in groupedItems[category]" :key="item.itemName" class="item-card">
                                                <img :src="getItemSprite(item.item)" :alt="item.itemName" loading="lazy" onerror="this.style.display='none'">
                                                <span class="item-count-badge">{{ item.count }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </section>
                    </div>

                    <!-- Right Column -->
                    <div class="right-column">
                        <section class="card" id="pokemon-summary">
                            <div class="summary-header">
                                <h2>Pokémon Highlights</h2>
                            </div>
                            <div id="pokemon-highlights-container">
                                <div v-for="p in highlights" :key="p.id" :class="getCardClass(p)" :style="createBackgroundStyle(p.typeColors)">
                                    <img :src="p.sprite" :alt="p.nickname || p.name" loading="lazy">
                                    <p class="pokemon-name" v-html="getBadges(p, p.nickname || p.name)"></p>
                                    <p class="pokemon-cp">CP {{ p.cp }}</p>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </section>

            <!-- Pokemon Tab -->
            <section id="pokemon-section" v-show="activeTab === 'pokemon'" class="card">
                <div class="summary-header">
                    <h2>My Pokémon ({{ filteredPokemon.length }})</h2>
                </div>
                <div class="sort-bar">
                    <input type="text" id="search-bar" placeholder="Search: shiny, electric, !legendary, etc." v-model="searchQuery">
                    <div class="sort-controls">
                        <label for="sort-by">Sort by:</label>
                        <select id="sort-by" v-model="sortKey">
                            <option value="caughtTime">Caught Time</option>
                            <option value="cp">Combat Power</option>
                            <option value="pokedex">Pokédex #</option>
                            <option value="name">Name</option>
                        </select>
                        <button id="sort-direction" @click="toggleSortDirection">{{ sortDirection === 'desc' ? '▼ Desc' : '▲ Asc' }}</button>
                    </div>
                </div>
                <grid-component :pokemons="filteredPokemon"></grid-component>
            </section>

            <!-- Statistics Tab -->
            <section id="statistics-section" v-show="activeTab === 'statistics'" class="card">
                <h2>Statistics</h2>
                <p>Statistics and other visualizations will be available in a future update.</p>
            </section>
        </main>
    </div>

    <!-- 2. Link to the external Vue Application Logic -->
    <script src="/scripts/private-vue.js"></script>
    <script src="/scripts/loadHeader.js"></script>
</body>
</html>

